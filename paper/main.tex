\documentclass[12pt]{article}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[margin=1in]{geometry}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{siunitx}
\usepackage{amsmath}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{natbib}
\usepackage{setspace}
\usepackage{fancyhdr}

% Python code style (gastropy-style)
\definecolor{codebg}{gray}{0.95}
\definecolor{codekw}{RGB}{128,0,128}
\definecolor{codestr}{RGB}{0,128,0}
\definecolor{codecmt}{gray}{0.5}

\lstdefinestyle{python}{
    language=Python,
    backgroundcolor=\color{codebg},
    basicstyle=\ttfamily\small,
    keywordstyle=\color{codekw}\bfseries,
    stringstyle=\color{codestr},
    commentstyle=\color{codecmt}\itshape,
    showstringspaces=false,
    breaklines=true,
    frame=single,
    rulecolor=\color{codebg},
    xleftmargin=2em,
    framexleftmargin=1.5em,
    numbers=none,
    tabsize=4,
    morekeywords={replace, ConditionDef, SegmentDef, TrialConfig, CONFIG,
                   ExperimentState, build_conditions},
}
\lstset{style=python}

\title{respyra: A General-Purpose Respiratory Tracking Toolbox for Interoception Research}

\author{
    Micah Allen\textsuperscript{1,2,*} \\[6pt]
    \small\textsuperscript{1}Center of Functionally Integrative Neuroscience, Aarhus University, Denmark \\
    \small\textsuperscript{2}Cambridge Psychiatry, University of Cambridge, United Kingdom \\[4pt]
    \small\textsuperscript{*}Corresponding author: \href{mailto:micah@cfin.au.dk}{micah@cfin.au.dk}
}
\date{}

\begin{document}
\maketitle

\begin{abstract}
Interoception research has focused primarily on perception, with comparatively little attention to the control of bodily state. Respiration offers a tractable entry point to this gap, as breathing is continuously sensed yet voluntarily regulated. We present \textit{respyra}, an open-source Python toolbox for respiratory tracking experiments that integrates PsychoPy with a low-cost wireless respiration belt to enable closed-loop breathing control with real-time visual feedback. Participants track prescribed breathing waveforms while the system synchronously records respiratory output and target dynamics. \textit{respyra} implements visuomotor gain perturbations that distort visual feedback while preserving task goals, allowing dissociation of baseline respiratory control from adaptive responses to altered sensorimotor mappings. In a proof-of-concept study, tracking was stable under veridical feedback, systematically disrupted under perturbation, showed trial-level adaptation, and demonstrated good reliability (Spearman--Brown = 0.86). The toolbox is distributed as an open-source Python package with a fully documented API and reproducible example experiments.
\end{abstract}

\noindent\textbf{Keywords:} respiratory interoception, sensorimotor adaptation, breathing, visuomotor perturbation, psychophysics, open-source toolbox

\onehalfspacing

\section{Introduction}

Interoception (the sensing, interpretation, and integration of signals originating from within the body) is a fundamental mechanism underlying emotional experience, cognitive function, and behavioral self-regulation \citep{garfinkel2015knowing, suksasilp2022towards}. Contemporary research distinguishes between interoceptive accuracy (objective behavioral performance), interoceptive sensibility (self-reported beliefs), and interoceptive awareness (metacognitive correspondence between accuracy and confidence), revealing that these dimensions are largely modality-specific \citep{garfinkel2015knowing, banellis2026interoceptive}.

While the cardiac axis has dominated interoception research, respiratory interoception (or respiroception) offers a physiologically distinctive modality because it is closely linked to affect and is amenable to direct conscious control \citep{nikolova2022respiratory, harrison2021interoception}. Slow deep breathing at approximately 0.1~Hz stimulates arterial baroreceptors, enhances respiratory sinus arrhythmia, and reduces sympathetic output \citep{gholamrezaei2021psychophysiological}. Beyond autonomic regulation, paced slow breathing reduces anticipatory anxiety and suppresses cortical beta-band arousal markers \citep{luo2025effect}. The respiratory cycle itself modulates neural oscillations and differentially gates exteroceptive versus interoceptive processing across inhalation and exhalation phases \citep{molle2022respiratory}.

Measuring respiroception has relied primarily on detection paradigms, such as the Filter Detection Task \citep{harrison2021interoception} and the Respiratory Resistance Sensitivity Task \citep{nikolova2022respiratory}, which quantify perceptual sensitivity to inspiratory loads. However, these approaches focus on interoceptive detection rather than on the sensorimotor dynamics of voluntary breathing control. This motor control dimension is central to breathing-based interventions and meditation practices, yet it has received comparatively little experimental attention.

The study of sensorimotor control offers well-established paradigms for investigating how the motor system adapts to perturbations in visual feedback. In visuomotor reaching studies, participants learn to compensate for rotated or scaled cursor feedback, revealing the dynamics of sensorimotor adaptation, error correction, and internal model updating \citep[e.g.,][]{krakauer2019motor}. Veridical and perturbed feedback conditions probe dissociable constructs: veridical tracking reflects baseline motor control ability, while perturbed tracking additionally engages the capacity to remap sensorimotor relationships when feedback is altered. The ratio of perturbed to veridical error isolates this remapping cost independent of baseline ability, providing a normalized individual-differences metric suitable for group comparisons. Applying analogous perturbation paradigms to respiratory control could clarify how individuals monitor and correct their breathing, and whether this capacity is disrupted in conditions such as panic disorder or chronic hyperventilation.

\textit{respyra} is an open-source Python toolbox for conducting respiratory tracking experiments with real-time biofeedback and visuomotor perturbation (Figure~\ref{fig:schematic}). The toolbox integrates a commercially available respiration belt with PsychoPy for stimulus-precise experiment control. This paper describes the system architecture and experimental protocol, and reports a single-participant validation study (48 trials across four sessions) demonstrating that (a) participants can accurately track sinusoidal breathing targets under veridical feedback, (b) visual gain perturbations reliably increase tracking error, (c) perturbed trials show within-block adaptation that degrades with fatigue while veridical performance remains stable, and (d) the task produces reliable trial-level measurements.

\section{Method}

\begin{figure}[htbp]
\centering
\includegraphics[width=\textwidth]{fig_task_schematic.png}
\caption{Schematic of the respiromotor tracking task. \textbf{(A)}~Task overview: the participant wears a respiration belt and views a monitor displaying their breathing trace in real time. A sinusoidal target guides the desired breathing pattern. Visual biofeedback can be veridically displayed or scaled by a gain factor $g$, creating a closed-loop sensorimotor control paradigm with afferent feedback and motor correction. \textbf{(B)}~Belt detail: the Vernier Go Direct Respiration Belt (GDX-RB) consists of an elastic strap with an embedded force sensor module that transmits data wirelessly via Bluetooth Low Energy (BLE).}
\label{fig:schematic}
\end{figure}

\subsection{Toolbox Architecture}

\textit{respyra} is implemented in Python 3.10 and integrates two primary components: the Vernier Go Direct Respiration Belt (GDX-RB; Vernier Software \& Technology) for real-time force-based respiratory measurement, and PsychoPy \citep{peirce2019psychopy} for stimulus presentation and experiment control. The GDX-RB was selected because it is inexpensive, well-documented, available worldwide through educational science suppliers, and offers wireless (BLE) operation out of the box, making it accessible to research and teaching laboratories without specialized biomedical equipment. The toolbox is organized into reusable core modules, configuration files, and experiment scripts (see Table~\ref{tab:modules}).

\begin{table}[htbp]
\caption{Core Modules of the respyra Toolbox}
\label{tab:modules}
\begin{tabular}{lp{10cm}}
\toprule
Module & Description \\
\midrule
\texttt{breath\_belt} & Non-blocking interface to the Vernier GDX-RB. A background thread continuously reads force samples (10~Hz) into a thread-safe queue, allowing the main PsychoPy frame loop to drain samples without blocking. Supports BLE and USB connections. \\
\texttt{display} & PsychoPy window management and a \texttt{SignalTrace} class that renders a scrolling waveform by updating \texttt{ShapeStim} vertices each frame. \\
\texttt{target\_generator} & Generates sinusoidal breathing targets from composable frequency--cycle segment definitions. Supports multi-segment waveforms with phase-continuous boundaries. \\
\texttt{data\_logger} & Incremental CSV logging with per-row flush for crash resilience. \\
\texttt{events} & Keyboard input helpers wrapping PsychoPy's event module. \\
\bottomrule
\end{tabular}
\end{table}

The respiration belt measures chest expansion force in Newtons (0--50~N range) via a force sensor embedded in an elastic chest strap. The belt communicates with the host computer via Bluetooth Low Energy (BLE) or USB. To resolve a platform-specific conflict on Windows (PsychoPy's graphics backend initializes COM in single-threaded apartment mode while the BLE scanner requires multi-threaded apartment mode), the toolbox connects the belt \textit{before} importing PsychoPy modules.

Experimental conditions are defined using a \texttt{ConditionDef} dataclass specifying a name, a list of \texttt{SegmentDef} objects (each with a target frequency in Hz and an integer cycle count), and an optional \texttt{feedback\_gain} parameter. The use of integer cycle counts ensures phase continuity at segment boundaries, allowing seamless composition of multi-frequency waveforms. Experiment parameters are organized into a hierarchical configuration dataclass (\texttt{ExperimentConfig}), enabling researchers to create new experimental designs by overriding specific parameters from a base configuration (see Appendix~A). Full documentation including an experiment creation tutorial is available at \url{https://embodied-computation-group.github.io/respyra/}.

\subsection{Visual Feedback and Perturbation}

The task display consists of two visual elements: a scrolling waveform trace showing the participant's real-time breathing signal, and a target dot that traverses a sinusoidal path at the prescribed target frequency. The dot's vertical position indicates the target force, and its color provides continuous error feedback using an HSV color mapping from green (low error) through yellow to red (high error), with a square-root transfer function for perceptual salience.

The visuomotor perturbation is implemented as a multiplicative gain applied to the visual trace display:
\begin{equation}
f_{\text{display}} = c + g \cdot (f_{\text{actual}} - c)
\label{eq:gain}
\end{equation}
where $f_{\text{actual}}$ is the raw belt force, $c$ is the participant's breathing center (from calibration), and $g$ is the feedback gain. When $g = 1.0$, the display is veridical. When $g > 1.0$, displayed deviations from center are amplified, requiring the participant to breathe with \textit{smaller} amplitude to match the visual target. The target dot position remains anchored to the physical target waveform, while the dot's color feedback reflects the \textit{visual error} (the discrepancy between the target and the displayed trace; see Equation~\ref{eq:visual_error}), ensuring that color feedback reflects the same discrepancy the participant sees, not the physical tracking error.

\subsection{Calibration}

Prior to the experimental trials, participants complete a 15-second range calibration phase during which they take several comfortable deep breaths. The force data collected during this phase are used to establish the participant's achievable breathing range. To handle outlier breaths and sensor artifacts, the toolbox applies percentile-based rejection (5th--95th percentile clipping). If force values approach the sensor limits ($\leq$~\SI{0}{\newton} or $\geq$~\SI{40}{\newton}), a warning dialog alerts the experimenter that the belt may be too tight. The clipped range is then scaled by a configurable factor (default 0.80) to set the target waveform amplitude, ensuring the sinusoidal target stays within the participant's comfortable range.

\subsection{Experimental Protocol}

Each session consists of a range calibration phase followed by a series of tracking trials. Each trial comprises three phases:

\begin{enumerate}
\item \textbf{Baseline} (10~s): The participant breathes naturally. Force data from this phase are used to compute a trial-specific breathing center via the midpoint of the observed range.
\item \textbf{Countdown} (3~s): A ``3\ldots2\ldots1'' countdown during which the target dot smoothly blends from the participant's current respiratory position into the target waveform trajectory.
\item \textbf{Tracking}: The participant follows the sinusoidal target dot with their breathing for a duration determined by the trial's frequency--cycle segment definitions. Force, target, and signed error are logged at every sample (\textasciitilde10~Hz). At the conclusion of each trial, mean absolute tracking error is displayed as performance feedback.
\end{enumerate}

Trial conditions are managed using PsychoPy's \texttt{TrialHandler}, supporting both blocked and randomized presentation orders across configurable numbers of repetitions. Figure~\ref{fig:tracking_screenshot} shows the task display during a veridical tracking trial.

\begin{figure}[htbp]
\centering
\includegraphics[width=0.85\textwidth]{fig_tracking_screenshot.png}
\caption{Screenshot of the task display during the tracking phase of a veridical trial ($g = 1.0$). The scrolling green trace shows the participant's real-time breathing signal. The green dot at the right edge of the trace area indicates the current target position; its color reflects tracking accuracy (green = low error, transitioning through yellow to red as error increases). The header shows the current trial number and the instruction text displays the time remaining.}
\label{fig:tracking_screenshot}
\end{figure}

\subsection{Validation Data Collection}

To validate the toolbox, a single experienced participant (male, first author) completed four sessions in a single sitting. Each session consisted of 12 tracking trials: six veridical feedback trials ($g = 1.0$) and six perturbed feedback trials ($g = 2.0$), presented in a blocked design. Each trial comprised four sinusoidal cycles at 0.1~Hz (40~s tracking duration). The starting condition was counterbalanced across sessions: sessions 1 and 3 began with the veridical block, while sessions 2 and 4 began with the perturbed block. Between sessions, the participant had the option to recalibrate the belt. The belt was worn around the lower ribcage and connected via BLE at 10~Hz sampling. The display was presented on a 1920$\times$1080 monitor at 57~cm viewing distance.

\subsection{Data Analysis}

Tracking performance was quantified using visual mean absolute error (visual MAE), defined as the mean absolute deviation between the target waveform and the displayed feedback trace during each trial's tracking phase:
\begin{equation}
\text{Visual MAE} = \frac{1}{n} \sum_{i=1}^{n} \left| f_{\text{target},i} - f_{\text{display},i} \right|
\label{eq:visual_error}
\end{equation}
where $f_{\text{display}}$ is defined by Equation~\ref{eq:gain}. For veridical trials ($g = 1$), visual MAE equals the physical tracking error. For perturbed trials ($g > 1$), visual MAE captures the error as experienced by the participant in the displayed feedback, the quantity the participant actively optimizes in the closed-loop control task.

The \textit{perturbation ratio} was computed as the ratio of perturbed visual MAE to veridical visual MAE within each session, providing a normalized index of the cost of sensorimotor remapping independent of baseline tracking ability.

The ratio of root mean square error to MAE (RMSE/MAE ratio) was computed as a secondary metric of error distribution shape. For normally distributed errors, this ratio equals $\sqrt{\pi/2} \approx 1.253$; values exceeding this reference indicate heavy-tailed error distributions with intermittent large deviations, suggestive of attentional lapses or control instability.

Respiratory metrics (breaths per minute, BPM, and peak-to-trough breathing depth) were computed for each trial using SciPy peak detection on the force signal. Breath phase was labeled continuously based on the gradient of the target sinusoid (rising phase = inspiration, falling phase = expiration).

Split-half reliability was assessed by correlating visual MAE between odd-numbered and even-numbered trials within each condition, with the Spearman--Brown prophecy formula applied to estimate full-test reliability.

All analyses were conducted at the trial level (each trial = one observation, $N = 48$). Statistics were computed using Python with pandas, NumPy, and SciPy.

\section{Results}

\subsection{Calibration}

Prior to each session, the participant completed the range calibration procedure. Calibration amplitude varied across sessions, with Session~1 producing a large target amplitude due to an excessively deep calibration breath, which increased the difficulty of tracking, particularly under perturbed feedback where the required breathing amplitude was halved by the $2\times$ gain. Baseline breathing centers were stable within sessions, consistent with a stable resting breathing position.

\subsection{Tracking Performance}

\input{table1_session_stats}

Table~\ref{tab:session_stats} presents session-level descriptive statistics. The participant maintained a breathing rate close to the 0.1~Hz (6~BPM) target across all sessions ($M = 6.1$~BPM). Under veridical feedback, visual MAE was \SI{0.243}{\newton} ($SD = \SI{0.070}{\newton}$ across sessions), suggesting that the participant tracked the sinusoidal target accurately. Under perturbation ($g = 2.0$), visual MAE increased to \SI{0.538}{\newton} ($SD = \SI{0.255}{\newton}$), yielding a mean perturbation ratio of $2.2\times$ (range: 1.68--2.61 across sessions). Figure~\ref{fig:examples} shows representative veridical and perturbed trial traces, and Figure~\ref{fig:qc} presents a complete session quality-control summary.

\begin{figure}[htbp]
\centering
\includegraphics[width=\textwidth]{fig1_example_trials.png}
\caption{Representative single-trial traces from Session~2. \textbf{Top row}: Veridical trial ($g = 1.0$). \textbf{Bottom row}: Perturbed trial ($g = 2.0$). Left panels show the target waveform (dashed) and displayed breathing trace (solid). Center panels show the visual error time series. Right panels show the error distribution with kernel density estimate. The perturbed trial shows larger and more variable errors, with characteristic overcorrection oscillations due to the amplified visual feedback.}
\label{fig:examples}
\end{figure}

\subsection{Within-Block Adaptation}

Within each session's block of perturbed trials, visual MAE decreased from the first to the last trial in early sessions, consistent with within-block sensorimotor adaptation. In Session~1, the within-block linear slope was $-0.094$ (decreasing MAE, i.e., improving), reflecting rapid remapping of the altered visual feedback. This within-block adaptation degraded across sessions: by Session~4, the slope reversed to $+0.058$ (increasing MAE, i.e., worsening). The linear trend in within-block slopes across sessions was significant ($r = +.957$, $p = .043$), suggesting that adaptive capacity declined across sessions, possibly reflecting cumulative fatigue. Veridical trials showed no comparable trend ($r = -.198$, $p = .80$; Figure~\ref{fig:session_perf}, bottom panels).

\subsection{Session Effects and Fatigue}

Session~2 showed the best overall perturbed performance (visual MAE = \SI{0.259}{\newton}), representing substantial cross-session savings from Session~1 (\SI{0.837}{\newton}). However, perturbed performance degraded in Sessions~3 and 4 (\SI{0.411}{\newton} and \SI{0.647}{\newton}, respectively), while veridical MAE remained relatively stable (range: 0.154--0.321~N; Figure~\ref{fig:session_perf}, top panels). The perturbation ratio followed a U-shaped trajectory across sessions: 2.61 $\rightarrow$ 1.68 $\rightarrow$ 1.79 $\rightarrow$ 2.42, consistent with initial learning followed by fatigue-driven degradation of remapping capacity.

The RMSE/MAE ratio for veridical trials remained close to the normal-distribution reference value of 1.253 ($M = 1.25$), consistent with steady, well-regulated tracking errors. For perturbed trials, the ratio was elevated ($M = 1.50$), reaching 1.72 in Session~4, suggesting increasingly heavy-tailed error distributions. Session~4 perturbed trials showed extreme excess kurtosis ($M = 10.6$) with individual errors reaching up to \SI{10}{\newton}, consistent with intermittent large deviations as might arise from attentional lapses or fatigue-driven loss of control.

\begin{figure}[htbp]
\centering
\includegraphics[width=\textwidth]{fig2_session_performance.png}
\caption{Session-level performance and within-block adaptation. \textbf{(A)}~Mean visual MAE by session and condition. Error bars indicate $\pm 1\,SD$. \textbf{(B)}~Perturbation ratio (perturbed visual MAE / veridical MAE) across sessions, showing a U-shaped trajectory consistent with initial learning followed by fatigue. \textbf{(C,~D)}~Within-block visual MAE across the six trials within each condition's block, plotted separately for veridical~(C) and perturbed~(D) trials. Each line represents one session. Perturbed trials show within-block adaptation in early sessions that reverses by Session~4.}
\label{fig:session_perf}
\end{figure}

\subsection{Breath Phase Effects}

Inspiration was consistently associated with larger tracking errors than expiration. For veridical trials, mean inspiratory visual MAE was \SI{0.260}{\newton} versus \SI{0.227}{\newton} for expiration, a marginal difference ($t(23) = 1.72$, $p = .099$). The RMSE/MAE ratio showed a significant phase difference under perturbation ($t(23) = 3.62$, $p = .002$), suggesting that inspiratory errors were more intermittent and heavy-tailed during perturbed tracking.

\subsection{Reliability}

Split-half reliability (odd vs.\ even trials) for visual MAE yielded $r = .759$. After Spearman--Brown correction, estimated full-test reliability was .857, indicating good measurement reliability at the trial level (Figure~\ref{fig:reliability}).

\begin{figure}[htbp]
\centering
\includegraphics[width=0.6\textwidth]{fig3_reliability.png}
\caption{Split-half reliability of visual MAE. Scatter plot of odd-trial versus even-trial mean visual MAE for each trial pair. Marker shape indicates condition (circles = veridical, squares = perturbed). Marker color indicates session. Spearman--Brown corrected reliability = .857.}
\label{fig:reliability}
\end{figure}

\begin{figure}[htbp]
\centering
\includegraphics[width=\textwidth]{fig4_qc_session.png}
\caption{Example quality-control session summary (Session~1) generated by the toolbox's built-in visualization module. Panels show the full-session force trace with target overlay, signed error time series, per-trial MAE, error distributions, and calibration stability. This automated diagnostic output allows the experimenter to assess data quality after each session.}
\label{fig:qc}
\end{figure}

\section{Discussion}

A single-participant validation study across 48 trials and four sessions demonstrated that \textit{respyra} produces stable respiratory tracking data and that the visuomotor perturbation paradigm engages measurable sensorimotor adaptation processes.

The validation data support the interpretation that veridical and perturbed feedback conditions tap dissociable aspects of respiratory control. Under veridical feedback, the participant maintained stable tracking performance across all four sessions. Under perturbation, performance showed a characteristic adaptation profile: initial learning across sessions (substantial cross-session savings from Session~1 to Session~2), followed by fatigue-related degradation in Sessions~3--4. The fatigue effect was selective, impairing perturbed performance while sparing veridical tracking, consistent with the view that the two conditions place different demands on the respiratory control system.

The perturbation ratio (perturbed visual MAE divided by veridical MAE) provides a normalized index of the cost of sensorimotor remapping, independent of baseline tracking ability. For group studies, this ratio provides a normalized index of sensorimotor flexibility: a participant with low veridical MAE and a low perturbation ratio demonstrates both good respiratory control and good sensorimotor flexibility, while high veridical MAE with a low ratio suggests poor control but intact adaptability. The U-shaped trajectory of the perturbation ratio across sessions (2.61 $\rightarrow$ 1.68 $\rightarrow$ 1.79 $\rightarrow$ 2.42) illustrates how fatigue can differentially affect remapping capacity, an effect that would be masked by examining raw performance alone.

The visual gain perturbation increases tracking error through a control-theoretic mechanism. Under $2\times$ gain, every motor correction produces twice the expected visual displacement, effectively doubling the loop gain of the visuomotor control system. This amplifies motor noise in the visual domain, causes corrective movements to overshoot, and reduces the stability margin of the control loop, resulting in more oscillatory and less precise convergence on the target. The elevated RMSE/MAE ratio under perturbation ($M = 1.50$ versus 1.25 for veridical) supports this interpretation: perturbation produces intermittent large deviations rather than a uniform increase in error, consistent with overshooting correction dynamics rather than a simple scaling of tracking difficulty.

The RMSE/MAE ratio proved informative as a secondary metric of control quality. While MAE captures the average magnitude of tracking error, the RMSE/MAE ratio distinguishes between steady, consistent errors (ratio near 1.253, the expected value for normally distributed errors) and intermittent large deviations (elevated ratio). This metric was particularly sensitive to the fatigue effects in Session~4, where the RMSE/MAE ratio for perturbed trials reached 1.72 with extreme kurtosis, even as mean MAE remained within a less dramatic range. The ratio also revealed breath-phase asymmetries that were not significant in MAE alone: under perturbation, inspiration produced significantly more heavy-tailed errors than expiration ($p = .002$), suggesting that the active inspiratory phase is more vulnerable to control instability under amplified feedback.

The finding that inspiration was consistently harder to control than expiration aligns with known biomechanical asymmetries in respiratory control. Inspiration is an active muscular process (primarily diaphragmatic), while expiration at rest is largely passive (elastic recoil). Under visual gain perturbation, the active inspiratory phase may be more susceptible to overcorrection and motor noise amplification, producing the observed heavier-tailed error distribution.

Several practical challenges emerged during the validation study that highlight areas for future improvement. Session~1 produced an unusually large calibration amplitude because the participant breathed too deeply during range calibration, resulting in a target waveform that was difficult to sustain, particularly under the $2\times$ gain perturbation where the required breathing amplitude was halved. In Session~3, a tightened belt compressed the usable force range and produced sensations of air hunger (inability to exhale fully), degrading performance. These observations suggest that calibrating from comfortable normal breathing (rather than maximal range) and accounting for the gain factor when setting target amplitude would produce more sustainable tracking demands in future protocols.

The validation data come from a single experienced participant (the developer), and performance may differ substantially in naive participants. Even so, the 48-trial, four-session design is more informative than a single session, and the good split-half reliability (Spearman--Brown = .857) indicates that the task produces stable individual measurements. The within-session fatigue effects (degraded perturbed performance in Sessions~3--4) complicate interpretation of the session effects, and future studies should include rest periods between sessions or spread sessions across multiple days. The 10~Hz sampling rate, while sufficient for tracking slow breathing patterns ($\sim$0.1~Hz), may miss sub-second transients in error dynamics. While the Vernier GDX-RB provides a reliable and affordable single-band force measurement, some applications may require more sophisticated respiratory monitoring such as dual-band respiratory inductance plethysmography (RIP); the toolbox's modular sensor interface is designed to accommodate such extensions.

The dissociation between respiratory control ability (veridical MAE) and sensorimotor flexibility (perturbation ratio) provides a framework for individual-differences research. In group studies, the perturbation ratio could be correlated with measures of respiratory interoceptive sensitivity \citep{nikolova2022respiratory} to investigate whether perceptual sensitivity to breathing predicts the capacity for sensorimotor remapping. Clinical populations with dysfunctional breathing patterns (including panic disorder, chronic hyperventilation, and chronic obstructive pulmonary disease) may show selective deficits in either baseline control or perturbation adaptation. The adaptation dynamics observed here (within-block learning, cross-session savings, fatigue effects) can be further characterized using the established motor learning framework, including studies of savings, interference, and transfer \citep{krakauer2019motor}. The toolbox is also suited to studies of breathing-based interventions, quantifying how accurately individuals can implement prescribed breathing patterns (e.g., paced slow breathing at 0.1~Hz) and how this accuracy relates to downstream physiological and psychological outcomes \citep{gholamrezaei2021psychophysiological, luo2025effect}.

\textit{respyra} is freely available at \url{https://github.com/embodied-computation-group/respyra} under an MIT license.

\subsection*{Acknowledgements}

This work was supported by the European Research Council under grant ERC-2020-StG-948788 and the Lundbeck Foundation under grant R272-2017-4345.

\bibliographystyle{apalike}
\bibliography{references}

\clearpage
\appendix
\section*{Appendix A: Creating Custom Experiments}
\addcontentsline{toc}{section}{Appendix A: Creating Custom Experiments}
\label{app:config}

The toolbox provides a structured configuration system that allows researchers to create new experiments by overriding parameters from a base configuration, without modifying source code. This appendix demonstrates the key patterns; full documentation is available at \url{https://embodied-computation-group.github.io/respyra/creating_experiments.html}.

\subsection*{Running an Experiment}

Experiments are launched from the command line using the \texttt{--config} flag to specify a configuration:

\begin{lstlisting}
# Built-in config by short name
respyra-task --config demo

# Custom config file
respyra-task --config experiments/my_study.py
\end{lstlisting}

\subsection*{Customizing Parameters}

Custom configs inherit from a base configuration and override specific fields using Python's \texttt{dataclasses.replace()}:

\begin{lstlisting}
from dataclasses import replace
from defaults import CONFIG as _BASE
from respyra.configs.experiment_config import TrialConfig
from respyra.configs.presets import slow_steady

CONFIG = replace(
    _BASE,
    name="My Study",
    timing=replace(_BASE.timing, tracking_duration_sec=50.0),
    display=replace(_BASE.display, fullscr=True),
    trial=TrialConfig(
        conditions=[slow_steady(n_cycles=5)] * 4,
        n_reps=1,
        method="sequential",
    ),
)
\end{lstlisting}

\subsection*{Defining Conditions}

The \texttt{presets} module provides factory functions for common paradigms. Custom conditions can also be built directly from \texttt{ConditionDef} and \texttt{SegmentDef}:

\begin{lstlisting}
from respyra.configs.presets import slow_steady, perturbed_slow
from respyra.core.target_generator import ConditionDef, SegmentDef

# Preset factories
easy = slow_steady(freq_hz=0.1, n_cycles=3)
hard = perturbed_slow(feedback_gain=2.0, n_cycles=4)

# Custom: graded gain levels
conditions = [
    ConditionDef("gain_1.0", [SegmentDef(0.1, 3)], feedback_gain=1.0),
    ConditionDef("gain_1.5", [SegmentDef(0.1, 3)], feedback_gain=1.5),
    ConditionDef("gain_2.0", [SegmentDef(0.1, 3)], feedback_gain=2.0),
]
\end{lstlisting}

\subsection*{Counterbalanced Designs}

For studies requiring counterbalancing, a \texttt{build\_conditions()} function receives the session number at runtime and returns the appropriate trial order:

\begin{lstlisting}
def build_conditions(session_num):
    if int(session_num) % 2 == 1:
        return [SLOW] * 6 + [PERTURBED] * 6  # A-B
    else:
        return [PERTURBED] * 6 + [SLOW] * 6  # B-A

CONFIG = replace(_BASE, trial=TrialConfig(
    conditions=build_conditions(1),
    build_conditions=build_conditions,
))
\end{lstlisting}

\subsection*{Composing Custom Flows}

For non-standard experiment structures, individual phase functions can be imported from the runner module and composed freely:

\begin{lstlisting}
from respyra.core.runner import (
    connect_belt, setup_display, run_range_calibration,
    run_baseline, run_countdown, run_tracking,
    ExperimentState,
)

belt = connect_belt(cfg)
win, stimuli = setup_display(cfg)
# ... create state, then compose phases as needed
run_range_calibration(state, cfg)
run_countdown(state, cfg, condition, ...)
run_tracking(state, cfg, condition, target_gen, ...)
\end{lstlisting}

\end{document}
